// profiles

profiles {
	conda {
        process {
			withLabel: "perl" { 
				conda = "${projectDir}/conda/perl.yaml"
			}
			
			withLabel: "non_perl" { 
				conda = "${projectDir}/conda/non-perl.yaml"
			}
		}

        conda.cacheDir = "${projectDir}/conda"
		conda.useMamba = true
    }

	docker {
		process {
			withLabel: "perl" { 
				container = "oxfordmmm/bugflow_perl"
			}
			
			withLabel: "non_perl" { 
				container = "oxfordmmm/bugflow_non_perl"
			}
		}

        docker.enabled = true
	}

	oci {
		workDir = "/mnt/scratch/work"
		process {
			cpus = 4 
		}
	}
}

// description
manifest {
    homePage = 'https://github.com/oxfordmmm/Bugflow_DSL2'
    description = 'Pipeline for mapping, variant calling and assembling bacterial sequencing data'
    mainScript = 'main.nf'
    version = '0.2'
}

// error options 
//default halt pipeline
//process.errorStrategy {task.attempt==1 ? 'retry' : 'finish'} //this only completes already pending tasks
//process.errorStrategy = 'ignore' //this logs the error, prevents subsequent tasks running, but continues other samples


// reporting
report {
	enabled = true
	file = "nextflow_reports/report.html"
}

timeline {
	enabled = true
	file = "nextflow_reports/timeline.html"
}
